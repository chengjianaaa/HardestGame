{"version":3,"sources":["CreatorHelper.js"],"names":["CreatorHelper","getNodeComponent","node","type","getComponent","createNewSpriteNode","cc","Node","sprite","addComponent","Sprite","touchInSprite","touch","locationInNode","convertToNodeSpace","getLocation","s","getContentSize","rect","width","height","rectContainsPoint","setNodeClickEvent","cb","on","EventType","TOUCH_END","setNodeClickEventWithContent","content","setPressEvent","TOUCH_START","setUnPressEvent","setCancelEvent","TOUCH_CANCEL","setMoveEvent","TOUCH_MOVE","event","changeSpriteFrame","url","loader","loadRes","SpriteFrame","err","spriteFrame","loadAllAudio","loadResAll","AudioClip","assets","audioMap","key","asset","name","getRealPath","localPath","raw","changeSpriteFrameWithServerUrl","sys","isNative","changeSpriteFrameWithServerUrlForWeb","console","log","load","tex2d","setTimeout","frame","setTexture","changeSpriteFrameWithServerUrlForNative","MD5","require","dirpath","jsb","fileUtils","getWritablePath","filepath","loadEnd","tex","error","saveFile","data","isDirectoryExist","createDirectory","writeDataToFile","Uint8Array","isFileExist","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseType","response","bind","open","send","screenShoot","func","Date","valueOf","size","director","getVisibleSize","rt","RenderTexture","create","getScene","_sgNode","addChild","setVisible","begin","visit","end","saveToFile","length","IMAGE_FORMAT_PNG","removeFromParent","module","exports"],"mappings":"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","file":"CreatorHelper.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["function CreatorHelper() {\r\n\r\n}\r\n\r\nCreatorHelper.getNodeComponent = function (node, type) {\r\n    return node.getComponent(type);\r\n}\r\n\r\nCreatorHelper.createNewSpriteNode = function () {\r\n    var node = new cc.Node();\r\n    var sprite = node.addComponent(cc.Sprite);\r\n    return sprite;\r\n}\r\n\r\nCreatorHelper.touchInSprite = function (touch, sprite) {\r\n    var locationInNode = sprite.convertToNodeSpace(touch.getLocation());\r\n    var s = sprite.getContentSize();\r\n    var rect = cc.rect(0, 0, s.width, s.height);\r\n    if (cc.rectContainsPoint(rect, locationInNode)) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n//设置Node点击事件\r\nCreatorHelper.setNodeClickEvent = function (node, cb) {\r\n    node.on(cc.Node.EventType.TOUCH_END, function () {\r\n        cb(node);\r\n    }, node);\r\n}\r\n\r\nCreatorHelper.setNodeClickEventWithContent = function (node,content,cb) {\r\n    node.on(cc.Node.EventType.TOUCH_END, function () {\r\n        cb(node)\r\n    }, content);\r\n}\r\n\r\n//添加点击的事件\r\nCreatorHelper.setPressEvent = function (node,cb) {\r\n    node.on(cc.Node.EventType.TOUCH_START, function () {\r\n        cb(node);\r\n    }, node);\r\n}\r\n//添加结束的事件\r\nCreatorHelper.setUnPressEvent = function (node,cb) {\r\n    node.on(cc.Node.EventType.TOUCH_END, function () {\r\n        cb(node);\r\n    }, node);\r\n}\r\n\r\n//添加取消的事件\r\nCreatorHelper.setCancelEvent = function (node,cb) {\r\n    node.on(cc.Node.EventType.TOUCH_CANCEL, function () {\r\n        cb(node);\r\n    }, node);\r\n}\r\n\r\n//添加移动的事件\r\nCreatorHelper.setMoveEvent = function (node,cb) {\r\n    node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n        cb(node,event);\r\n    }, node);\r\n}\r\n\r\n\r\n\r\n\r\n//通过路径更换SpriteFrame,固定大小\r\nCreatorHelper.changeSpriteFrame = function (sprite, url) {\r\n    cc.loader.loadRes(url, cc.SpriteFrame, function (err, spriteFrame) {\r\n        var width = sprite.node.width;\r\n        var height = sprite.node.height;\r\n        sprite.spriteFrame = spriteFrame;\r\n        sprite.node.width = width;\r\n        sprite.node.height = height;\r\n    });\r\n}\r\n\r\n//加载目录下所有的音频文件，并返回一个名字和文件对应的Json\r\nCreatorHelper.loadAllAudio = function (url, cb) {\r\n    cc.loader.loadResAll(url, cc.AudioClip, function (err, assets) {\r\n        var audioMap = {};\r\n        for (var key in assets) {\r\n            var asset = assets[key];\r\n            audioMap[asset.name] = asset;\r\n            cb(audioMap);\r\n        }\r\n    });\r\n}\r\n\r\nCreatorHelper.getRealPath = function (localPath) {\r\n    return cc.url.raw(localPath);\r\n}\r\n\r\n//根据远程服务器加载图片\r\nCreatorHelper.changeSpriteFrameWithServerUrl = function (sprite, url) {\r\n    if (cc.sys.isNative) {\r\n        CreatorHelper.changeSpriteFrameWithServerUrlForWeb(sprite, url);\r\n        //CreatorHelper.changeSpriteFrameWithServerUrlForNative(sprite, url);\r\n    } else {\r\n        CreatorHelper.changeSpriteFrameWithServerUrlForWeb(sprite, url);\r\n    }\r\n}\r\n//web模式下从远程下载并更换图片\r\nCreatorHelper.changeSpriteFrameWithServerUrlForWeb = function (sprite, url) {\r\n    if (!sprite)return;\r\n    console.log(\"changeSpriteFrameWithServerUrlForWeb=-====>\",sprite,url)\r\n    cc.loader.load(url, function (err, tex2d) {\r\n        if (err) {\r\n            setTimeout(function () {\r\n                CreatorHelper.changeSpriteFrameWithServerUrl(sprite, url);\r\n            }, 1000);\r\n        } else {\r\n            var frame = new cc.SpriteFrame();\r\n            frame.setTexture(tex2d);\r\n            sprite.spriteFrame = frame;\r\n            console.log(\"changeSpriteFrameWithServerUrlForWeb=-====>2\",sprite,tex2d)\r\n            //cc.textureCache.addImage(url);\r\n        }\r\n    });\r\n}\r\n\r\n//native模式下从远程下载并更换图片(只支持png格式的文件下载，后面有需要在改)\r\nCreatorHelper.changeSpriteFrameWithServerUrlForNative = function (sprite, url) {\r\n    var MD5 = require(\"MD5\");\r\n    var dirpath = jsb.fileUtils.getWritablePath() + '/ServerImages/';\r\n    var filepath = dirpath + MD5(url) + '.png';\r\n    cc.log(\"存储地址是\"+filepath);\r\n    function loadEnd() {\r\n        cc.loader.load(filepath, function (err, tex) {\r\n            if (err) {\r\n                cc.error(err);\r\n            } else {\r\n                var spriteFrame = new cc.SpriteFrame(tex);\r\n                if (spriteFrame) {\r\n                    sprite.spriteFrame = spriteFrame;\r\n                    //cc.textureCache.addImage(filepath);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    var saveFile = function (data) {\r\n        if (typeof data !== 'undefined') {\r\n            if (!jsb.fileUtils.isDirectoryExist(dirpath)) {\r\n                jsb.fileUtils.createDirectory(dirpath);\r\n            }\r\n            if (jsb.fileUtils.writeDataToFile(new Uint8Array(data), filepath)) {\r\n                cc.log('Remote write file succeed.');\r\n                loadEnd();\r\n            } else {\r\n                cc.log('Remote write file failed.');\r\n            }\r\n        } else {\r\n            cc.log('Remote download file failed.');\r\n        }\r\n    };\r\n\r\n    if (jsb.fileUtils.isFileExist(filepath)) {\r\n        cc.log('Remote is find' + filepath);\r\n        loadEnd();\r\n        return;\r\n    }\r\n\r\n\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        cc.log(\"xhr.readyState  \" + xhr.readyState);\r\n        cc.log(\"xhr.status  \" + xhr.status);\r\n        if (xhr.readyState === 4) {\r\n            if (xhr.status === 200) {\r\n                xhr.responseType = 'arraybuffer';\r\n                saveFile(xhr.response);\r\n            } else {\r\n                saveFile(null);\r\n                setTimeout(function () {\r\n                    CreatorHelper.changeSpriteFrameWithServerUrlForNative(sprite,url);\r\n                },1000)\r\n            }\r\n        }\r\n    }.bind(this);\r\n    xhr.open(\"GET\", url, true);\r\n    xhr.send();\r\n}\r\n\r\n//截图\r\nCreatorHelper.screenShoot = function(func) {\r\n    if (!cc.sys.isNative) return;\r\n    var dirpath = jsb.fileUtils.getWritablePath() + 'ScreenShoot/';\r\n    if (!jsb.fileUtils.isDirectoryExist(dirpath)) {\r\n        jsb.fileUtils.createDirectory(dirpath);\r\n    }\r\n    var name = 'ScreenShoot-' + (new Date()).valueOf() + '.png';\r\n    var filepath = dirpath + name;\r\n    var size = cc.director.getVisibleSize();\r\n    var rt = cc.RenderTexture.create(size.width, size.height);\r\n    cc.director.getScene()._sgNode.addChild(rt);\r\n    rt.setVisible(false);\r\n    rt.begin();\r\n    cc.director.getScene()._sgNode.visit();\r\n    rt.end();\r\n    cc.log(rt.saveToFile.length);\r\n    rt.saveToFile('ScreenShoot/' + name, cc.IMAGE_FORMAT_PNG, true, function() {\r\n        cc.log('save succ');\r\n        cc.log(filepath);\r\n        rt.removeFromParent();\r\n        if (func) {\r\n            func(filepath);\r\n        }\r\n    });\r\n};\r\n\r\n\r\nmodule.exports = CreatorHelper;"]}